(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var m=c.jgrid;c.fn.jqFilter=function(f){if("string"===typeof f){var r=c.fn.jqFilter[f];if(!r)throw"jqFilter - No such method: "+f;var D=c.makeArray(arguments).slice(1);return r.apply(this,D)}var a=c.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,
sopt:null,ops:[],operands:null,numopts:"eq ne lt le gt ge nu nn in ni".split(" "),stropts:"eq ne bw bn ew en cn nc nu nn in ni".split(" "),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},m.filter,f||{});return this.each(function(){if(!this.filter){this.p=a;if(null===a.filter||void 0===a.filter)a.filter={groupOp:a.groupOps[0].op,rules:[],groups:[]};var f,r=a.columns.length,g,F=/msie/i.test(navigator.userAgent)&&!window.opera,
x=c.isFunction,G=null!=m.defaults&&x(m.defaults.fatalError)?m.defaults.fatalError:alert,v=function(){return c("#"+m.jqID(a.id))[0]||null},q=function(d,a){return c(v()).jqGrid("getGuiStyles",d,a||"")},B=function(d){return c(v()).jqGrid("getGridRes","search."+d)},H=function(c){var d=v(),b=d.p.iColByName[c];if(void 0!==b)return{cm:d.p.colModel[b],iCol:b};b=d.p.iPropByName[c];return void 0!==b?{cm:d.p.colModel[b],iCol:b,isAddProp:!0}:{cm:null,iCol:-1}},E=q("states.error"),D=q("dialog.content");a.initFilter=
c.extend(!0,{},a.filter);if(r){for(f=0;f<r;f++)g=a.columns[f],g.stype?g.inputtype=g.stype:g.inputtype||(g.inputtype="text"),g.sorttype?g.searchtype=g.sorttype:g.searchtype||(g.searchtype="string"),void 0===g.hidden&&(g.hidden=!1),g.label||(g.label=g.name),g.cmName=g.name,g.index&&(g.name=g.index),g.hasOwnProperty("searchoptions")||(g.searchoptions={}),g.hasOwnProperty("searchrules")||(g.searchrules={});a.showQuery&&c(this).append("<table class='queryresult "+D+"' style='display:block;max-width:440px;border:0px none;' dir='"+
a.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var I=function(c,n){var b=[!0,""],d=v();if(x(n.searchrules))b=n.searchrules.call(d,c,n);else if(m&&m.checkValues)try{b=m.checkValues.call(d,c,-1,n.searchrules,n.label)}catch(t){}b&&b.length&&!1===b[0]&&(a.error=!b[0],a.errmsg=b[1])};this.onchange=function(){a.error=!1;a.errmsg="";return x(a.onChange)?a.onChange.call(v(),a,this):!1};this.reDraw=function(){c("table.group:first",this).remove();var d=this.createTableForGroup(a.filter,
null);c(this).append(d);x(a.afterRedraw)&&a.afterRedraw.call(v(),a,this)};this.createTableForGroup=function(d,n){var b=this,h,t=c("<table class='"+q("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),e="left";"rtl"===a.direction&&(e="right",t.attr("dir","rtl"));null===n&&t.append("<tr class='error' style='display:none;'><th colspan='5' class='"+E+"' align='"+e+"'></th></tr>");var k=c("<tr></tr>");t.append(k);e=c("<th colspan='5' align='"+e+"'></th>");k.append(e);
if(!0===a.ruleButtons){var g=c("<select class='"+q("searchDialog.operationSelect","opsel")+"'></select>");e.append(g);var k="",f;for(h=0;h<a.groupOps.length;h++)f=d.groupOp===b.p.groupOps[h].op?" selected='selected'":"",k+="<option value='"+b.p.groupOps[h].op+"'"+f+">"+b.p.groupOps[h].text+"</option>";g.append(k).on("change",function(){d.groupOp=c(g).val();b.onchange()})}k="<span></span>";a.groupButton&&(k=c("<input type='button' value='+ {}' title='"+B("addGroupTitle")+"' class='"+q("searchDialog.addGroupButton",
"add-group")+"'/>"),k.on("click",function(){void 0===d.groups&&(d.groups=[]);d.groups.push({groupOp:a.groupOps[0].op,rules:[],groups:[]});b.reDraw();b.onchange();return!1}));e.append(k);if(!0===a.ruleButtons){var k=c("<input type='button' value='+' title='"+B("addRuleTitle")+"' class='"+q("searchDialog.addRuleButton","add-rule ui-add")+"'/>"),m;k.on("click",function(){var a,e,k;void 0===d.rules&&(d.rules=[]);for(h=0;h<b.p.columns.length;h++)if(a=void 0===b.p.columns[h].search?!0:b.p.columns[h].search,
e=!0===b.p.columns[h].hidden,(k=!0===b.p.columns[h].searchoptions.searchhidden)&&a||a&&!e){m=b.p.columns[h];break}a=m.searchoptions.sopt?m.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==c.inArray(m.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;d.rules.push({field:m.name,op:a[0],data:""});b.reDraw();return!1});e.append(k)}null!==n&&(k=c("<input type='button' value='-' title='"+B("deleteGroupTitle")+"' class='"+q("searchDialog.deleteGroupButton","delete-group")+"'/>"),e.append(k),k.on("click",function(){for(h=
0;h<n.groups.length;h++)if(n.groups[h]===d){n.groups.splice(h,1);break}b.reDraw();b.onchange();return!1}));if(void 0!==d.groups)for(h=0;h<d.groups.length;h++)e=c("<tr></tr>"),t.append(e),k=c("<td class='first'></td>"),e.append(k),k=c("<td colspan='4'></td>"),k.append(this.createTableForGroup(d.groups[h],d)),e.append(k);void 0===d.groupOp&&(d.groupOp=b.p.groupOps[0].op);if(void 0!==d.rules)for(h=0;h<d.rules.length;h++)t.append(this.createTableRowForRule(d.rules[h],d));return t};this.createTableRowForRule=
function(d,n){var b=this,h=v(),g=c("<tr></tr>"),e,k,f,p="",u;g.append("<td class='first'></td>");var l=c("<td class='columns'></td>");g.append(l);var r=c("<select class='"+q("searchDialog.label","selectLabel")+"'></select>"),y,w=[];l.append(r);r.on("change",function(){d.field=c(r).val();var a=c(this).parents("tr:first"),e,f;for(f=0;f<b.p.columns.length;f++)if(b.p.columns[f].name===d.field){e=b.p.columns[f];break}if(e){f=c.extend({},e.editoptions||{});delete f.readonly;delete f.disabled;var g=c.extend({},
f||{},e.searchoptions||{},H(e.cmName),{id:m.randId(),name:e.name,mode:"search"});g.column=e;F&&"text"===e.inputtype&&!g.size&&(g.size=10);var n=m.createEl.call(h,e.inputtype,g,"",!0,b.p.ajaxSelectOptions||{},!0);c(n).addClass(q("searchDialog.elem","input-elm"));k=g.sopt?g.sopt:b.p.sopt?b.p.sopt:-1!==c.inArray(e.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;e="";var t=0,l,p;w=[];c.each(b.p.ops,function(){w.push(this.oper)});b.p.cops&&c.each(b.p.cops,function(b){w.push(b)});for(f=0;f<k.length;f++)p=
k[f],y=c.inArray(k[f],w),-1!==y&&(l=b.p.ops[y],l=void 0!==l?l.text:b.p.cops[p].text,0===t&&(d.op=p),e+="<option value='"+p+"'>"+l+"</option>",t++);c(".selectopts",a).empty().append(e);c(".selectopts",a)[0].selectedIndex=0;m.msie&&9>m.msiever()&&(f=parseInt(c("select.selectopts",a)[0].offsetWidth,10)+1,c(".selectopts",a).width(f),c(".selectopts",a).css("width","auto"));c(".data",a).empty().append(n);m.bindEv.call(h,n,g);c(".input-elm",a).on("change",function(a){a=a.target;d.data="SPAN"===a.nodeName.toUpperCase()&&
g&&x(g.custom_value)?g.custom_value.call(h,c(a).children(".customelement:first"),"get"):a.value;c(a).is("input[type=checkbox]")&&!c(a).is(":checked")&&(d.data=c(a).data("offval"));b.onchange()});setTimeout(function(){d.data=c(n).val();b.onchange()},0)}});var l=0,z,A;for(e=0;e<b.p.columns.length;e++)if(u=void 0===b.p.columns[e].search?!0:b.p.columns[e].search,z=!0===b.p.columns[e].hidden,(A=!0===b.p.columns[e].searchoptions.searchhidden)&&u||u&&!z)u="",d.field===b.p.columns[e].name&&(u=" selected='selected'",
l=e),p+="<option value='"+b.p.columns[e].name+"'"+u+">"+b.p.columns[e].label+"</option>";r.append(p);p=c("<td class='operators'></td>");g.append(p);f=a.columns[l];F&&"text"===f.inputtype&&!f.searchoptions.size&&(f.searchoptions.size=10);l=c.extend({},f.editoptions||{});delete l.readonly;delete l.disabled;l=c.extend({},l,f.searchoptions||{},H(f.cmName),{id:m.randId(),name:f.name});l.column=f;l=m.createEl.call(h,f.inputtype,l,d.data,!0,b.p.ajaxSelectOptions||{},!0);if("nu"===d.op||"nn"===d.op)c(l).attr("readonly",
"true"),c(l).attr("disabled","true");var C=c("<select class='"+q("searchDialog.operator","selectopts")+"'></select>");p.append(C);C.on("change",function(){d.op=c(C).val();var a=c(this).parents("tr:first"),a=c(".input-elm",a)[0];"nu"===d.op||"nn"===d.op?(d.data="","SELECT"!==a.tagName.toUpperCase()&&(a.value=""),a.setAttribute("readonly","true"),a.setAttribute("disabled","true")):("SELECT"===a.tagName.toUpperCase()&&(d.data=a.value),a.removeAttribute("readonly"),a.removeAttribute("disabled"));b.onchange()});
k=f.searchoptions.sopt?f.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==c.inArray(f.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;p="";c.each(b.p.ops,function(){w.push(this.oper)});b.p.cops&&c.each(b.p.cops,function(b){w.push(b)});for(e=0;e<k.length;e++)A=k[e],y=c.inArray(k[e],w),-1!==y&&(z=b.p.ops[y],u=d.op===A?" selected='selected'":"",p+="<option value='"+A+"'"+u+">"+(void 0!==z?z.text:b.p.cops[A].text)+"</option>");C.append(p);p=c("<td class='data'></td>");g.append(p);p.append(l);m.bindEv.call(h,
l,f.searchoptions);c(l).addClass(q("searchDialog.elem","input-elm")).on("change",function(){d.data="custom"===f.inputtype?f.searchoptions.custom_value.call(h,c(this).children(".customelement:first"),"get"):c(this).val();c(this).is("input[type=checkbox]")&&!c(this).is(":checked")&&(d.data=c(this).data("offval"));b.onchange()});p=c("<td></td>");g.append(p);!0===a.ruleButtons&&(l=c("<input type='button' value='-' title='"+B("deleteRuleTitle")+"' class='"+q("searchDialog.deleteRuleButton","delete-rule ui-del")+
"'/>"),p.append(l),l.on("click",function(){for(e=0;e<n.rules.length;e++)if(n.rules[e]===d){n.rules.splice(e,1);break}b.reDraw();b.onchange();return!1}));return g};this.getStringForGroup=function(c){var a="(",b;if(void 0!==c.groups)for(b=0;b<c.groups.length;b++){1<a.length&&(a+=" "+c.groupOp+" ");try{a+=this.getStringForGroup(c.groups[b])}catch(h){G(h)}}if(void 0!==c.rules)try{for(b=0;b<c.rules.length;b++)1<a.length&&(a+=" "+c.groupOp+" "),a+=this.getStringForRule(c.rules[b])}catch(h){G(h)}a+=")";
return"()"===a?"":a};this.getStringForRule=function(d){var f="",b="",h,g,e=d.data,k;for(h=0;h<a.ops.length;h++)if(a.ops[h].oper===d.op){f=a.operands.hasOwnProperty(d.op)?a.operands[d.op]:"";b=a.ops[h].oper;break}if(""===b&&null!=a.cops)for(k in a.cops)if(a.cops.hasOwnProperty(k)&&(b=k,f=a.cops[k].operand,x(a.cops[k].buildQueryValue)))return a.cops[k].buildQueryValue.call(a,{cmName:d.field,searchValue:e,operand:f});for(h=0;h<a.columns.length;h++)if(a.columns[h].name===d.field){g=a.columns[h];break}if(null==
g)return"";if("bw"===b||"bn"===b)e+="%";if("ew"===b||"en"===b)e="%"+e;if("cn"===b||"nc"===b)e="%"+e+"%";if("in"===b||"ni"===b)e=" ("+e+")";a.errorcheck&&I(d.data,g);return-1!==c.inArray(g.searchtype,["int","integer","float","number","currency"])||"nn"===b||"nu"===b?d.field+" "+f+" "+e:d.field+" "+f+' "'+e+'"'};this.resetFilter=function(){a.filter=c.extend(!0,{},a.initFilter);this.reDraw();this.onchange()};this.hideError=function(){c("th."+E,this).html("");c("tr.error",this).hide()};this.showError=
function(){c("th."+E,this).html(a.errmsg);c("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(a.filter)};this.toString=function(){function c(b){var a="(",d;if(void 0!==b.groups)for(d=0;d<b.groups.length;d++)1<a.length&&(a="OR"===b.groupOp?a+" || ":a+" && "),a+=c(b.groups[d]);if(void 0!==b.rules)for(d=0;d<b.rules.length;d++){1<a.length&&(a="OR"===b.groupOp?a+" || ":a+" && ");var e=b.rules[d];if(f.p.errorcheck){var g,m=void 0;for(g=0;g<f.p.columns.length;g++)if(f.p.columns[g].name===
e.field){m=f.p.columns[g];break}m&&I(e.data,m)}a+=e.op+"(item."+e.field+",'"+e.data+"')"}a+=")";return"()"===a?"":a}var f=this;return c(a.filter)};this.reDraw();if(a.showQuery)this.onchange();this.filter=!0}}})};c.extend(c.fn.jqFilter,{toSQLString:function(){var c="";this.each(function(){c=this.toUserFriendlyString()});return c},filterData:function(){var c;this.each(function(){c=this.p.filter});return c},getParameter:function(c){return void 0!==c&&this.p.hasOwnProperty(c)?this.p[c]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},
addFilter:function(f){"string"===typeof f&&(f=c.parseJSON(f));this.each(function(){this.p.filter=f;this.reDraw();this.onchange()})}})});
//# sourceMappingURL=grid.filter.map
