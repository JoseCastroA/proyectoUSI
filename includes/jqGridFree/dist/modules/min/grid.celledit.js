(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var t=c.jgrid,C=function(){var a=c.makeArray(arguments);a.unshift("");a.unshift("");a.unshift(this.p);return t.feedback.apply(this,a)},D=function(a,b){var g=this.grid.fbRows;return c((null!=g&&g[0].cells.length>b?g[a.rowIndex]:a).cells[b])};t.extend({editCell:function(a,b,g){return this.each(function(){var d=
this,e=c(d),f=d.p,l,h,k,m;l=d.rows;if(d.grid&&!0===f.cellEdit&&null!=l&&null!=l[a]&&(a=parseInt(a,10),b=parseInt(b,10),!isNaN(a)&&!isNaN(b))){var w=l[a],n=null!=w?w.id:null,p=c(w),q=parseInt(f.iCol,10),u=parseInt(f.iRow,10),B=c(l[u]),x=f.savedRow;if(null!=n){f.selrow=n;f.knv||e.jqGrid("GridNav");if(0<x.length){if(!0===g&&a===u&&b===q)return;e.jqGrid("saveCell",x[0].id,x[0].ic)}else setTimeout(function(){c("#"+t.jqID(f.knv)).attr("tabindex","-1").focus()},1);m=f.colModel[b];l=m.name;if("subgrid"!==
l&&"cb"!==l&&"rn"!==l){k=D.call(d,w,b);w=m.editable;c.isFunction(w)&&(w=w.call(d,{rowid:n,iCol:b,iRow:a,name:l,cm:m,mode:"cell"}));var v=e.jqGrid("getGuiStyles","states.select","edit-cell"),y=e.jqGrid("getGuiStyles","states.hover","selected-row");if(!0!==w||!0!==g||k.hasClass("not-editable-cell"))0<=q&&0<=u&&(D.call(d,B[0],q).removeClass(v),B.removeClass(y)),k.addClass(v),p.addClass(y),h=k.html().replace(/&#160;/ig,""),C.call(d,"onSelectCell",n,l,h,a,b);else{0<=q&&0<=u&&(D.call(d,B[0],q).removeClass(v),
B.removeClass(y));k.addClass(v);p.addClass(y);m.edittype||(m.edittype="text");p=m.edittype;try{h=c.unformat.call(d,k,{rowId:n,colModel:m},b)}catch(F){h="textarea"===p?k.text():k.html()}f.autoEncodeOnEdit&&(h=t.oldDecodePostedData(h));x.push({id:a,ic:b,name:l,v:h});if("&nbsp;"===h||"&#160;"===h||1===h.length&&160===h.charCodeAt(0))h="";c.isFunction(f.formatCell)&&(q=f.formatCell.call(d,n,l,h,a,b),void 0!==q&&(h=q));C.call(d,"beforeEditCell",n,l,h,a,b);m=c.extend({},m.editoptions||{},{id:a+"_"+l,name:l,
rowId:n,mode:"cell",cm:m,iCol:b});var z=t.createEl.call(d,p,m,h,!0,c.extend({},t.ajaxOptions,f.ajaxSelectOptions||{})),p=k;(q=!0===f.treeGrid&&l===f.ExpandColumn)&&(p=k.children("span.cell-wrapperleaf,span.cell-wrapper"));p.html("").append(z).attr("tabindex","0");q&&c(z).width(k.width()-k.children("div.tree-wrap").outerWidth());t.bindEv.call(d,z,m);setTimeout(function(){c(z).focus()},1);c("input, select, textarea",k).on("keydown",function(g){27===g.keyCode&&(0<c("input.hasDatepicker",k).length?c(".ui-datepicker").is(":hidden")?
e.jqGrid("restoreCell",a,b):c("input.hasDatepicker",k).datepicker("hide"):e.jqGrid("restoreCell",a,b));if(13===g.keyCode&&!g.shiftKey)return e.jqGrid("saveCell",a,b),!1;if(9===g.keyCode){if(d.grid.hDiv.loading)return!1;g.shiftKey?e.jqGrid("prevCell",a,b):e.jqGrid("nextCell",a,b)}g.stopPropagation()});C.call(d,"afterEditCell",n,l,h,a,b);e.triggerHandler("jqGridAfterEditCell",[n,l,h,a,b])}f.iCol=b;f.iRow=a}}}})},saveCell:function(a,b){return this.each(function(){var g=this,d=c(g),e=g.p,f=g.grid,l=t.info_dialog,
h=t.jqID;if(f&&!0===e.cellEdit){var k=d.jqGrid("getGridRes","errors"),m=k.errcap,w=d.jqGrid("getGridRes","edit").bClose,n=e.savedRow,p=1<=n.length?0:null;if(null!==p){var q=g.rows[a],u=q.id,B=c(q),x=e.colModel[b],v=x.name,y,z=D.call(g,q,b),F={},r=t.getEditedValue.call(g,z,x,F);if(r!==n[p].v){y=d.triggerHandler("jqGridBeforeSaveCell",[u,v,r,a,b]);void 0!==y&&(r=y);c.isFunction(e.beforeSaveCell)&&(y=e.beforeSaveCell.call(g,u,v,r,a,b),void 0!==y&&(r=y));var E=t.checkValues.call(g,r,b,void 0,void 0,{oldValue:n[p].v,
newValue:r,cmName:v,rowid:u,iCol:b,iRow:a,cm:x,tr:q,td:z,mode:"cell"}),q=x.formatoptions||{};if(null==E||!0===E||!0===E[0]){p=d.triggerHandler("jqGridBeforeSubmitCell",[u,v,r,a,b])||{};c.isFunction(e.beforeSubmitCell)&&((p=e.beforeSubmitCell.call(g,u,v,r,a,b))||(p={}));0<c("input.hasDatepicker",z).length&&c("input.hasDatepicker",z).datepicker("hide");"date"===x.formatter&&!0!==q.sendFormatted&&(r=c.unformat.date.call(g,r,x));if("remote"===e.cellsubmit)if(e.cellurl){var A={};A[v]=r;k=e.prmNames;q=
k.oper;A[k.id]=t.stripPref(e.idPrefix,u);A[q]=k.editoper;A=c.extend(p,A);e.autoEncodeOnEdit&&c.each(A,function(a,b){c.isFunction(b)||(A[a]=t.oldEncodePostedData(b))});d.jqGrid("progressBar",{method:"show",loadtype:e.loadui,htmlcontent:d.jqGrid("getGridRes","defaults.savetext")||"Saving..."});f.hDiv.loading=!0;c.ajax(c.extend({url:c.isFunction(e.cellurl)?e.cellurl.call(g,e.cellurl,a,b,u,r,v):e.cellurl,data:t.serializeFeedback.call(g,e.serializeCellData,"jqGridSerializeCellData",A),type:"POST",complete:function(h){f.endReq.call(g);
if((300>h.status||304===h.status)&&(0!==h.status||4!==h.readyState)){var k=d.triggerHandler("jqGridAfterSubmitCell",[g,h,A.id,v,r,a,b])||[!0,""];if(!0===k||!0===k[0]&&c.isFunction(e.afterSubmitCell))k=e.afterSubmitCell.call(g,h,A.id,v,r,a,b);null==k||!0===k||!0===k[0]?(d.jqGrid("setCell",u,b,r,!1,!1,!0),z.addClass("dirty-cell"),B.addClass("edited"),C.call(g,"afterSaveCell",u,v,r,a,b),n.splice(0,1)):(l.call(g,m,k[1],w),d.jqGrid("restoreCell",a,b))}},error:function(k,h,f){d.triggerHandler("jqGridErrorCell",
[k,h,f]);c.isFunction(e.errorCell)?e.errorCell.call(g,k,h,f):l.call(g,m,k.status+" : "+k.statusText+"<br/>"+h,w);d.jqGrid("restoreCell",a,b)}},t.ajaxOptions,e.ajaxCellOptions||{}))}else try{l.call(g,m,k.nourl,w),d.jqGrid("restoreCell",a,b)}catch(G){}"clientArray"===e.cellsubmit&&(d.jqGrid("setCell",u,b,"select"===x.edittype&&"select"!==x.formatter?F.text:r,!1,!1,!0),z.addClass("dirty-cell"),B.addClass("edited"),C.call(g,"afterSaveCell",u,v,r,a,b),n.splice(0,1))}else try{setTimeout(function(){l.call(g,
m,r+" "+E[1],w)},100),d.jqGrid("restoreCell",a,b)}catch(G){}}else d.jqGrid("restoreCell",a,b)}setTimeout(function(){c("#"+h(e.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(a,b){return this.each(function(){var g=this.p,d=this.rows[a],e=d.id,f,l;if(this.grid&&!0===g.cellEdit){var h=g.savedRow;f=D.call(this,d,b);if(1<=h.length){if(c.isFunction(c.fn.datepicker))try{c("input.hasDatepicker",f).datepicker("hide")}catch(k){}d=g.colModel[b];!0===g.treeGrid&&d.name===g.ExpandColumn?f.children("span.cell-wrapperleaf,span.cell-wrapper").empty():
f.empty();f.attr("tabindex","-1");f=h[0].v;l=d.formatoptions||{};"date"===d.formatter&&!0!==l.sendFormatted&&(f=c.unformat.date.call(this,f,d));c(this).jqGrid("setCell",e,b,f,!1,!1,!0);C.call(this,"afterRestoreCell",e,f,a,b);h.splice(0,1)}setTimeout(function(){c("#"+g.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(a,b){return this.each(function(){var g=c(this),d=this.p,e=!1,f,l,h,k=this.rows;if(this.grid&&!0===d.cellEdit&&null!=k&&null!=k[a]){for(f=b+1;f<d.colModel.length;f++)if(h=d.colModel[f],
l=h.editable,c.isFunction(l)&&(l=l.call(this,{rowid:k[a].id,iCol:f,iRow:a,name:h.name,cm:h,mode:"cell"})),!0===l){e=f;break}!1!==e?g.jqGrid("editCell",a,e,!0):0<d.savedRow.length&&g.jqGrid("saveCell",a,b)}})},prevCell:function(a,b){return this.each(function(){var g=c(this),d=this.p,e=!1,f,l,h,k=this.rows;if(this.grid&&!0===d.cellEdit&&null!=k&&null!=k[a]){for(f=b-1;0<=f;f--)if(h=d.colModel[f],l=h.editable,c.isFunction(l)&&(l=l.call(this,{rowid:k[a].id,iCol:f,iRow:a,name:h.name,cm:h,mode:"cell"})),
!0===l){e=f;break}!1!==e?g.jqGrid("editCell",a,e,!0):0<d.savedRow.length&&g.jqGrid("saveCell",a,b)}})},GridNav:function(){return this.each(function(){function a(a,b,e){a=g.rows[a];if("v"===e.substr(0,1)){var d=k.clientHeight,h=k.scrollTop,c=a.offsetTop+a.clientHeight,f=a.offsetTop;"vd"===e&&c>=d&&(k.scrollTop+=a.clientHeight);"vu"===e&&f<h&&(k.scrollTop-=a.clientHeight)}"h"===e&&(e=k.scrollLeft,b=a.cells[b],a=b.offsetLeft,b.offsetLeft+b.clientWidth>=k.clientWidth+parseInt(e,10)?k.scrollLeft+=b.clientWidth:
a<e&&(k.scrollLeft-=b.clientWidth))}function b(a,b){var g=0,d,h=e.colModel;if("lft"===b)for(g=a+1,d=a;0<=d;d--)if(!0!==h[d].hidden){g=d;break}if("rgt"===b)for(g=a-1,d=a;d<h.length;d++)if(!0!==h[d].hidden){g=d;break}return g}var g=this,d=c(g),e=g.p,f=g.grid,l,h;if(f&&!0===e.cellEdit){var k=f.bDiv;e.knv=e.id+"_kn";var m=c("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+e.knv+"'></div></div>");c(m).insertBefore(f.cDiv);c("#"+
e.knv).focus().keydown(function(k){var c=parseInt(e.iRow,10),f=parseInt(e.iCol,10);h=k.keyCode;"rtl"===e.direction&&(37===h?h=39:39===h&&(h=37));switch(h){case 38:0<c-1&&(a(c-1,f,"vu"),d.jqGrid("editCell",c-1,f,!1));break;case 40:c+1<=g.rows.length-1&&(a(c+1,f,"vd"),d.jqGrid("editCell",c+1,f,!1));break;case 37:0<=f-1&&(l=b(f-1,"lft"),a(c,l,"h"),d.jqGrid("editCell",c,l,!1));break;case 39:f+1<=e.colModel.length-1&&(l=b(f+1,"rgt"),a(c,l,"h"),d.jqGrid("editCell",c,l,!1));break;case 13:0<=f&&0<=c&&d.jqGrid("editCell",
c,f,!0);break;default:return!0}return!1})}})},getChangedCells:function(a){var b=[];a||(a="all");this.each(function(){var g=this,d=g.p,e=t.htmlDecode,f=g.rows;g.grid&&!0===d.cellEdit&&c(f).each(function(l){var h={};if(c(this).hasClass("edited")){var k=this;c(this.cells).each(function(b){var m=d.colModel[b],n=m.name,p=D.call(g,k,b);if("cb"!==n&&"subgrid"!==n&&"rn"!==n&&("dirty"!==a||p.hasClass("dirty-cell")))try{h[n]=c.unformat.call(g,p[0],{rowId:f[l].id,colModel:m},b)}catch(q){h[n]=e(p.html())}});
h.id=this.id;b.push(h)}})});return b}})});
//# sourceMappingURL=grid.celledit.map
